<link rel='import' href='./common/ticker-event.html'>

<dom-module id='ticker-events'>
  <template>
    <div class='fit' style='z-index:-1'><content></content></div>
    <div id='eventsContainer'>
      <template is='dom-repeat' items='[[_events]]'>
        <ticker-event event='[[item]]'></ticker-event>
      </template>
    </div>
  </template>
</dom-module>
<script>
(function(){
var CHUNK_SIZE = 3;

Polymer({
  is: 'ticker-events',
  properties:{
    _events:{
      type:Array,
      value:[]
    },
    _currentRenderIndex:{
      type:Number,
      value:0
    }
  },
  behaviors:[
    syncState(['events'])
  ],
  observers:[
    '_eventsChanged(events)'
  ],
  _eventsChanged:function(events){
    if(events && events.length){
      this._beginRenderingChunks();
      this.toggleClass('is-fading-in', true, this.$.eventsContainer);
    }
    else {
      this.toggleClass('is-fading-in', false, this.$.eventsContainer);
    }
  },
  _beginRenderingChunks:function(){
    this.__renderChunk = this.__renderChunk || this._renderChunk.bind(this);
    this._currentRenderIndex = 0;
    this.__renderChunk();
  },
  _renderChunk:function(){
    var events = this.events;
    var curIndex = this._currentRenderIndex;
    var nextIndex = curIndex + CHUNK_SIZE;
    var newAdditions = events.slice(curIndex, nextIndex);
    this.splice.apply(this, ['_events', curIndex, CHUNK_SIZE].concat(newAdditions));

    if(nextIndex < events.length){
      this._currentRenderIndex = nextIndex;
      window.requestAnimationFrame(this.__renderChunk);
    }
  }
});

})();
</script>
