<link rel='import' href='../../components/paper-button/paper-button.html'>
<link rel='import' href='../../components/paper-item/paper-item.html'>

<style>
ticker-search {
  display: none;
  z-index: 2;
  padding: 4px;
  background: rgba(0, 0, 0, 0.6);
}

ticker-search.is-enabled {
  display: block;
}

.ticker-search__input {
  outline: none;
  border: none;
  background: transparent;
}

.ticker-search__result-icon {
  display: none;
  border-radius: 50%;
  margin-left: -4px;
  width: 32px;
  height: 32px;
}

.ticker-search__result-icon[src] {
  display: block;
}
</style>
<dom-module id='ticker-search'>
  <template>
    <div class='c-bg-white l-overflow-hidden u-border-radius-2'>
      <div class='layout horizontal u-border-1 c-border-gray-lighter'>
        <paper-button style='min-width:48px' on-tap='_onCloseSearch'>
          <iron-icon icon='ticker:arrow-back'></iron-icon>
        </paper-button>
        <input class='l-padding-l1 ticker-search__input flex t-font-size-16'
               placeholder='Search Github Repo, User or Organization'
               on-input='_onSearchTextInput'/>
      </div>
      <template is='x-repeat' items='[[appSearchResults]]'>
        <paper-icon-item class='c-gray-darkest l-padding-r0' icon-width='32px'>
          <img item-icon
               src$='[[item.avatar_url]]'
               class='ticker-search__result-icon'>
          <iron-icon item-icon
                     hidden='[[item.avatar_url]]'
                     class='c-gray-light'
                     icon='github:book'
                     style='padding-left:1px'></iron-icon>

          <paper-item-body two-line
                           class='l-margin-l6 u-border-b1 c-border-gray-lighter'>
            <span>[[item.login]]</span>
            <ticker-repo-name repo-name='[[item.full_name]]'
                              hidden='[[!item.full_name]]'></ticker-repo-name>
            <div secondary class='c-gray-dark l-padding-r4'>[[item.description]]</div>
          </paper-item-body>
        </paper-icon-item>
      </template>
    </div>
  </template>
</dom-module>
<script>
Polymer({
  is: 'ticker-search',
  hostAttributes:{
    class: 'fixed-top fixed-bottom'
  },

  behaviors:[
    new SyncState({
      appSearch: 'appSearch',
      appSearchResults: 'appSearchResults'
    })
  ],

  properties:{
    appSearch:{
      type:Boolean,
      value:false,
      observer: '_appSearchChanged'
    }
  },

  _appSearchChanged: function(val){ this.toggleClass('is-enabled', !!val); },

  _onCloseSearch: function(){ appState.fire('appSearchClose'); },

  _onSearchTextInput: function(e){
    appState.fire('appSearchTextChanged', e.target.value);
  }
})
</script>
